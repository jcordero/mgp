/*
 * Jsgauge 0.4
 * http://code.google.com/p/jsgauge/
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/mit-license.php
 */function Gauge(e,d){var f=this;this.canvas=e;d=d||{};this.settings={value:d.value||0,pointerValue:d.value||0,label:d.label||"",unitsLabel:d.unitsLabel||"",min:d.min||0,max:d.max||100,majorTicks:d.majorTicks||5,minorTicks:d.minorTicks||2,greenFrom:[].concat(d.greenFrom||0),greenTo:[].concat(d.greenTo||0),yellowFrom:[].concat(d.yellowFrom||0),yellowTo:[].concat(d.yellowTo||0),redFrom:[].concat(d.redFrom||0),redTo:[].concat(d.redTo||0)};function b(k){var h,j=k.max-k.min,m=j/100,l;if(k.pointerValue>k.max){k.pointerValue=k.max}else{if(k.pointerValue<k.min){k.pointerValue=k.min}}l={min:0,max:100,value:(k.value-k.min)/m,pointerValue:(k.pointerValue-k.min)/m,label:k.label||"",greenFrom:[],greenTo:[],yellowFrom:[],yellowTo:[],redFrom:[],redTo:[],majorTicks:Math.max(2,k.majorTicks),minorTicks:Math.max(0,k.minorTicks),decimals:Math.max(0,3-(k.max-k.min).toFixed(0).length)};for(h=k.greenFrom.length;h--;){l.greenFrom[h]=(k.greenFrom[h]-k.min)/m}for(h=k.greenTo.length;h--;){l.greenTo[h]=(k.greenTo[h]-k.min)/m}for(h=k.yellowFrom.length;h--;){l.yellowFrom[h]=(k.yellowFrom[h]-k.min)/m}for(h=k.yellowTo.length;h--;){l.yellowTo[h]=(k.yellowTo[h]-k.min)/m}for(h=k.redFrom.length;h--;){l.redFrom[h]=(k.redFrom[h]-k.min)/m}for(h=k.redTo.length;h--;){l.redTo[h]=(k.redTo[h]-k.min)/m}return l}this.relSettings=b(this.settings);this.colors={text:d.colorOfText||"rgb(0, 0, 0)",warningText:d.colorOfWarningText||"rgb(255, 0, 0)",fill:d.colorOfFill||["#111","#ccc","#ddd","#eee"],pointerFill:d.colorOfPointerFill||"rgba(255, 100, 0, 0.7)",pointerStroke:d.colorOfPointerStroke||"rgba(255, 100, 100, 0.9)",centerCircleFill:d.colorOfCenterCircleFill||"rgba(0, 100, 255, 1)",centerCircleStroke:d.colorOfCenterCircleStroke||"rgba(0, 0, 255, 1)",redBand:d.colorOfRedBand||d.redColor||"rgba(255, 0, 0, 0.2)",yelBand:d.colorOfYellowBand||d.yellowColor||"rgba(255, 215, 0, 0.2)",grnBand:d.colorOfGreenBand||d.greenColor||"rgba(0, 255, 0, 0.2)"};function g(h,i){h.font=i;h.mozTextStyle=i}function a(h,i){if(h.measureText){return h.measureText(i).width}else{if(h.mozMeasureText){return h.mozMeasureText(i)}}throw"measureText() not supported!"}function c(j,l,i,h){var k;if(j.fillText){return j.fillText(l,i,h)}else{if(j.mozDrawText){j.save();j.translate(i,h);k=j.mozDrawText(l);j.restore();return k}}throw"fillText() not supported!"}this.drawBackground=function(){var k=f.colors.fill,h=[this.radius,this.radius-1,this.radius*0.98,this.radius*0.95],j;this.c2d.rotate(this.startDeg);for(j=0;j<k.length;j++){this.c2d.fillStyle=k[j];this.c2d.beginPath();this.c2d.arc(0,0,h[j],0,this.spanDeg,false);this.c2d.fill()}};this.drawRange=function(k,j,i){if(j>k){var h=this.spanDeg*(j-k)/100;this.c2d.rotate(this.startDeg);this.c2d.fillStyle=i;this.c2d.rotate(this.spanDeg*k/100);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.arc(0,0,this.outerRadius,0,h,false);this.c2d.rotate(h);this.c2d.lineTo(this.innerRadius,0);this.c2d.arc(0,0,this.innerRadius,0,-h,true);this.c2d.fill()}};this.drawTicks=function(o,k){var n,m,h;this.c2d.rotate(this.startDeg);this.c2d.lineWidth=this.radius*0.025;n=this.spanDeg/(o-1);for(m=0;m<o;m++){this.c2d.beginPath();this.c2d.moveTo(this.innerRadius,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke();if(m+1<o){this.c2d.save();this.c2d.lineWidth=this.radius*0.01;var l=n/(k+1);for(h=0;h<k;h++){this.c2d.rotate(l);this.c2d.beginPath();this.c2d.moveTo(this.innerRadius+(this.outerRadius-this.innerRadius)/3,0);this.c2d.lineTo(this.outerRadius,0);this.c2d.stroke()}this.c2d.restore()}this.c2d.rotate(n)}};this.drawPointer=function(h){function i(j){j.c2d.beginPath();j.c2d.moveTo(-j.radius*0.2,0);j.c2d.lineTo(0,j.radius*0.05);j.c2d.lineTo(j.radius*0.8,0);j.c2d.lineTo(0,-j.radius*0.05);j.c2d.lineTo(-j.radius*0.2,0)}this.c2d.rotate(this.startDeg);this.c2d.rotate(this.spanDeg*h/100);this.c2d.lineWidth=this.radius*0.015;this.c2d.fillStyle=f.colors.pointerFill;i(this);this.c2d.fill();this.c2d.strokeStyle=f.colors.pointerStroke;i(this);this.c2d.stroke();this.c2d.fillStyle=f.colors.centerCircleFill;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.fill();this.c2d.strokeStyle=f.colors.centerCircleStroke;this.c2d.beginPath();this.c2d.arc(0,0,this.radius*0.1,0,Math.PI*2,true);this.c2d.stroke()};this.drawCaption=function(i){if(i){var l=this.radius/5;g(this.c2d,l.toFixed(0)+"px sans-serif");var k=a(this.c2d,i);this.c2d.fillStyle=f.colors.text;var j=-k/2;var h=-this.radius*0.4+l/2;c(this.c2d,i,j,h)}};this.drawValues=function(k,n,o,j){var h,p,m,l;function i(s,q){var r=s.toFixed(q);while((q>0)&&r.match(/^\d+\.(\d+)?0$/)){q-=1;r=s.toFixed(q)}return r}l=i(o,j)+f.settings.unitsLabel;p=this.radius/5;g(this.c2d,p.toFixed(0)+"px sans-serif");m=a(this.c2d,l);if(o<k||o>n){this.c2d.fillStyle=f.colors.warningText}else{this.c2d.fillStyle=f.colors.text}c(this.c2d,l,-m/2,this.radius*0.72);this.save();h=Math.PI*14.5/8;this.c2d.translate(this.radius*0.65*Math.sin(h),this.radius*0.65*Math.cos(h));p=this.radius/8;g(this.c2d,p.toFixed(0)+"px sans-serif");this.c2d.fillStyle=f.colors.text;c(this.c2d,i(k,j),0,0);this.restore();this.save();h=Math.PI*17.5/8;this.c2d.translate(this.radius*0.65*Math.sin(h),this.radius*0.65*Math.cos(h));p=this.radius/8;g(this.c2d,p.toFixed(0)+"px sans-serif");m=a(this.c2d,i(n,j));this.c2d.fillStyle=f.colors.text;c(this.c2d,i(n,j),-m,0);this.restore()};this.draw();return this}Gauge.prototype.setValue=function(e){var d=this,c=(e>d.settings.max)?d.settings.max:(e<d.settings.min)?d.settings.min:e,a=Math.abs(d.settings.pointerValue-c)/20;function b(){var f;if(d.settings.pointerValue<c){d.settings.pointerValue+=a;if(d.settings.pointerValue+a>=c){d.settings.pointerValue=c}}else{d.settings.pointerValue-=a;if(d.settings.pointerValue-a<=c){d.settings.pointerValue=c}}f=d.settings.max-d.settings.min;d.relSettings.pointerValue=(d.settings.pointerValue-d.settings.min)/(f/100);d.draw();if(d.settings.pointerValue!=c){setTimeout(b,50)}}if(!isNaN(e)&&this.settings.value!==e){this.settings.value=e;b()}};Gauge.prototype.draw=function(){var b,a,d;if(!this.canvas.getContext){return}var c={c2d:this.canvas.getContext("2d"),startDeg:Math.PI*5.5/8,spanDeg:Math.PI*13/8,save:function(){this.c2d.save()},restore:function(){this.c2d.restore()},call:function(f){var e=Array.prototype.slice.call(arguments);this.save();this.translateCenter();f.apply(this,e.slice(1));this.restore()},clear:function(){this.c2d.clearRect(0,0,this.width,this.height)},translateCenter:function(){this.c2d.translate(this.centerX,this.centerY)}};c.width=c.c2d.canvas.width;c.height=c.c2d.canvas.height;c.radius=Math.min(c.width/2-4,c.height/2-4);c.innerRadius=c.radius*0.7;c.outerRadius=c.radius*0.9;c.centerX=c.radius+4;c.centerY=c.radius+4+(c.radius-c.radius*Math.sin(c.startDeg))/2;c.clear();c.call(this.drawBackground);for(b=this.relSettings.redFrom.length;b--;){c.call(this.drawRange,this.relSettings.redFrom[b],this.relSettings.redTo[b],this.colors.redBand)}for(a=this.relSettings.greenFrom.length;a--;){c.call(this.drawRange,this.relSettings.greenFrom[a],this.relSettings.greenTo[a],this.colors.grnBand)}for(d=this.relSettings.yellowFrom.length;d--;){c.call(this.drawRange,this.relSettings.yellowFrom[d],this.relSettings.yellowTo[d],this.colors.yelBand)}c.call(this.drawTicks,this.relSettings.majorTicks,this.relSettings.minorTicks);c.call(this.drawPointer,this.relSettings.pointerValue);c.call(this.drawCaption,this.relSettings.label);c.call(this.drawValues,this.settings.min,this.settings.max,this.settings.value,this.relSettings.decimals)};